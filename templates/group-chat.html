{% extends "base.html" %}

{% block title %}{{ group.name }} - SociaFam{% endblock %}

{% block extra_css %}
<style>
    .group-chat-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 70px);
        background-color: white;
    }
    
    .group-chat-header {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #e4e6eb;
    }
    
    .group-chat-back {
        margin-right: 15px;
        font-size: 20px;
        cursor: pointer;
    }
    
    .group-chat-avatar {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        margin-right: 15px;
    }
    
    .group-chat-info {
        flex-grow: 1;
    }
    
    .group-chat-name {
        font-weight: 600;
        margin-bottom: 2px;
    }
    
    .group-chat-members {
        font-size: 14px;
        color: #65676b;
    }
    
    .group-chat-header-actions {
        display: flex;
        gap: 15px;
    }
    
    .group-chat-header-action {
        font-size: 18px;
        color: #65676b;
        cursor: pointer;
    }
    
    .group-chat-messages {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
        background-color: #f0f2f5;
    }
    
    .group-message {
        margin-bottom: 15px;
        max-width: 70%;
    }
    
    .group-message.sent {
        margin-left: auto;
    }
    
    .group-message.received {
        margin-right: auto;
    }
    
    .group-message-sender {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #65676b;
    }
    
    .group-message-content {
        padding: 10px 15px;
        border-radius: 18px;
        margin-bottom: 5px;
    }
    
    .group-message.sent .group-message-content {
        background-color: #1877f2;
        color: white;
    }
    
    .group-message.received .group-message-content {
        background-color: white;
        color: #1c1e21;
        border: 1px solid #e4e6eb;
    }
    
    .group-message-time {
        font-size: 12px;
        color: #65676b;
        padding: 0 5px;
    }
    
    .group-chat-input-container {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-top: 1px solid #e4e6eb;
        background-color: white;
    }
    
    .group-chat-input-action {
        font-size: 20px;
        color: #65676b;
        margin-right: 15px;
        cursor: pointer;
    }
    
    .group-chat-input {
        flex-grow: 1;
    }
    
    .group-chat-input input {
        width: 100%;
        padding: 12px;
        border: 1px solid #dddfe2;
        border-radius: 20px;
        outline: none;
    }
    
    .group-chat-send {
        margin-left: 15px;
    }
    
    .group-chat-send button {
        background-color: #1877f2;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .group-chat-members-sidebar {
        position: fixed;
        top: 70px;
        right: 0;
        bottom: 0;
        width: 300px;
        background-color: white;
        border-left: 1px solid #e4e6eb;
        padding: 20px;
        overflow-y: auto;
        transform: translateX(100%);
        transition: transform 0.3s;
        z-index: 1000;
    }
    
    .group-chat-members-sidebar.open {
        transform: translateX(0);
    }
    
    .group-chat-members-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e4e6eb;
    }
    
    .group-chat-members-title {
        font-size: 18px;
        font-weight: 600;
    }
    
    .group-chat-members-close {
        font-size: 20px;
        cursor: pointer;
    }
    
    .group-chat-member {
        display: flex;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #e4e6eb;
    }
    
    .group-chat-member:last-child {
        border-bottom: none;
    }
    
    .group-chat-member-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 15px;
    }
    
    .group-chat-member-name {
        flex-grow: 1;
        font-weight: 600;
    }
    
    .group-chat-member-role {
        font-size: 14px;
        color: #65676b;
    }
    
    .group-chat-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 999;
    }
    
    .group-chat-overlay.open {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="group-chat-container">
    <div class="group-chat-header">
        <div class="group-chat-back" onclick="history.back()">
            <i class="fas fa-arrow-left"></i>
        </div>
        
        <img src="{{ url_for('static', filename='images/default-group.png') }}" alt="{{ group.name }}" class="group-chat-avatar">
        
        <div class="group-chat-info">
            <div class="group-chat-name">{{ group.name }}</div>
            <div class="group-chat-members">{{ group.members.count() }} members</div>
        </div>
        
        <div class="group-chat-header-actions">
            <div class="group-chat-header-action" onclick="toggleMembersSidebar()">
                <i class="fas fa-users"></i>
            </div>
            <div class="group-chat-header-action">
                <i class="fas fa-phone"></i>
            </div>
            <div class="group-chat-header-action">
                <i class="fas fa-video"></i>
            </div>
            <div class="group-chat-header-action">
                <i class="fas fa-info-circle"></i>
            </div>
        </div>
    </div>
    
    <div class="group-chat-messages" id="messagesContainer">
        <!-- Group messages will be loaded here -->
        <div class="group-message received">
            <div class="group-message-sender">John Doe</div>
            <div class="group-message-content">Hello everyone!</div>
            <div class="group-message-time">2 hours ago</div>
        </div>
        
        <div class="group-message sent">
            <div class="group-message-content">Hi John! How are you?</div>
            <div class="group-message-time">1 hour ago</div>
        </div>
    </div>
    
    <div class="group-chat-input-container">
        <div class="group-chat-input-action">
            <i class="fas fa-plus"></i>
        </div>
        
        <div class="group-chat-input-action">
            <i class="fas fa-image"></i>
        </div>
        
        <div class="group-chat-input-action">
            <i class="fas fa-camera"></i>
        </div>
        
        <div class="group-chat-input">
            <input type="text" placeholder="Type a message..." id="messageInput">
        </div>
        
        <div class="group-chat-send">
            <button id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<div class="group-chat-members-sidebar" id="membersSidebar">
    <div class="group-chat-members-header">
        <div class="group-chat-members-title">Group Members</div>
        <div class="group-chat-members-close" onclick="toggleMembersSidebar()">
            <i class="fas fa-times"></i>
        </div>
    </div>
    
    <div class="group-chat-members-list">
        {% for member in group.members %}
        <div class="group-chat-member">
            <img src="{{ url_for('get_profile_image', user_id=member.user.id) }}" alt="{{ member.user.username }}" class="group-chat-member-avatar">
            
            <div class="group-chat-member-name">
                {{ member.user.real_name or member.user.username }}
            </div>
            
            <div class="group-chat-member-role">
                {% if member.is_admin %}Admin{% else %}Member{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="group-chat-overlay" id="membersOverlay" onclick="toggleMembersSidebar()"></div>
{% endblock %}

{% block extra_js %}
<script>
    function toggleMembersSidebar() {
        const sidebar = document.getElementById('membersSidebar');
        const overlay = document.getElementById('membersOverlay');
        
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
    }
    
    // Handle sending messages (similar to regular chat)
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    
    if (messageInput && sendButton) {
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    }
    
    function sendMessage() {
        const content = messageInput.value.trim();
        
        if (!content) return;
        
        // In a real implementation, this would send the message to the server
        console.log('Sending message:', content);
        
        // Clear input
        messageInput.value = '';
    }
</script>
{% endblock %}
